---
public: false
title: 'microCMSとNext.jsでのカテゴリーごとのページネーション'
publishedDate: '2023.00.00'
modifiedDate: '2023.00.00'
description: 'template'
category: 'Next.js'
---

## 目次

## はじめに

[前回の記事](/posts/25)で microCMS と Next.js によるカテゴリー絞り込みについて取り上げてみたのですが、カテゴリーページ内でのページネーションについてもつまったところがあったので解説していきたいと思います。

## カテゴリーページの作成

まず、カテゴリーページを作成します。

今回は Next.js13 の app ディレクトリで実装しているので、こんな感じのディレクトリ構成でカテゴリーページを作成します。

```
/src/app/[category]/page/[number]/page.tsx
```

この`[category]`に対して、動的ルーティングをしてあげるとカテゴリーページの作成ができるようになります。  
そして、`[number]`には各ページごとの番号をわりふっていきます。

app ディレクトリでは`generateStaticParams`で動的ルーティングを行います。

```jsx
export async function generateStaticParams() {
  // コンテンツを取得
  const contentsData = await getMicroCMSDataList('contents')
  // コンテンツの合計数
  const { totalCount } = contentsData
  // ページネーションの範囲
  const range = (start: number, end: number) =>
    [...Array(end - start + 1)].map((_, i) => start + i)
  // カテゴリーを取得
  const categoriesData: MicroCMSCategoryData = await getMicroCMSData('category')
  // [category]と[number]に当てはめるための値を設定
  const categoryParams = categoriesData.contents.flatMap((content) =>
    range(1, Math.ceil(totalCount / PER_PAGE)).map((number) => ({
      category: content.english,
      number: number.toString(),
    }))
  )
  return categoryParams
}
```

こうすることで、例えば`content.english`に`fruit`とかが入っているのであれば、`/fruit`というカテゴリーページが作成されるようになりました！

ページネーションの範囲に関しても`1~(コンテンツの合計数/１ページに表示する件数)`として、`[number]`にそれぞれはめ込んでページを作成していきます。

## 各ページでのコンテンツ取得

カテゴリーページが作成できたところで、ページ内のコンテンツを取得していきましょう。
ここで気をつけるのは、カテゴリー内すべてのコンテンツを取得するのではなく、1 ページに表示する分だけのコンテンツ数を取得することです。

そのためには、以下の要素が必要になります。

- コンテンツ名
- 何件目から取得するか
- 1 ページに表示するコンテンツ数
- 表示したいカテゴリーの id

```jsx
export default async function Category({ params }: { params: Props }) {
  const { category, number } = params
  const currentNumber = Number(number)
  const categoryName: string = category
  const categoriesData: MicroCMSCategoryData = await getMicroCMSData('contents')
  const categoryData = categoriesData.contents.filter(
    (content) => content.english === category
  )
  const categoryId = categoryData[0]?.id
  const contentsData: MicroCMSContentsData = await getMicroCMSDataList(
    'contents',
    (currentNumber - 1) * 10,
    10,
    categoryId
  )
  const { contents, totalCount } = contentsData
}
```

## ページネーションの実装

## 参考

## さいごに
